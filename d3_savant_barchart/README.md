# D3.js NPB Baseball Statistics Visualization

## 概要
D3.jsを使用して、NPB（日本プロ野球）の打撃成績データをパーセンタイルランキングのバーチャートとして可視化するプロジェクトです。Baseball Savantスタイルのビジュアライゼーションを実装しています。

## ファイル構成

### barchart_sample.html
NPB打撃成績のパーセンタイルランキングを可視化するHTMLファイルです。

**主な機能：**
- チーム選択プルダウン：NPBの全チームから選択可能
- 選手選択プルダウン：選択したチームに所属する選手をPA（打席数）降順で表示
- パーセンタイルバーチャート：選手の成績を8つの指標でビジュアル表示

**表示される指標：**
1. AVG（打率）
2. OBP（出塁率）
3. SLG（長打率）
4. OPS（出塁率+長打率）
5. wOBA（加重出塁率）
6. wRAA（加重得点価値）
7. wRC（加重得点創出）
8. wRC+（球場補正済み加重得点創出）

**チャートの特徴：**
- カラーグラデーション：成績の良し悪しを色で表現（青→グレー→赤）
- 参照線：POOR（5%）、AVERAGE（50%）、GREAT（95%）の位置を表示
- PA閾値：301打席未満の選手は斜線パターンと透明度で区別
- フォント：Roboto Condensed（Google Fonts）を使用
- レスポンシブデザイン：中央配置、白背景のカード形式

**技術スタック：**
- D3.js v7：データビジュアライゼーション
- 純粋なCSS：スタイリング（Tailwind CSSは使用せず）
- バニラJavaScript：インタラクション処理

### barchart_sample_data.json
NPB選手の打撃成績データを格納したJSONファイルです。

**データ構造：**
各選手のレコードには以下のフィールドが含まれます：

- **基本情報：**
  - `Name`: 選手名
  - `Team`: 所属チーム（NPBの12球団）
  - `PA`: 打席数
  - `Qual`: 規定打席到達フラグ（1: 到達、0: 未到達）

- **打撃成績：**
  - `AVG`: 打率
  - `OBP`: 出塁率
  - `SLG`: 長打率
  - `OPS`: 出塁率+長打率
  - `ISO`: 長打率-打率
  - `wOBA`: 加重出塁率
  - `wRAA`: 加重得点価値
  - `wRC`: 加重得点創出
  - `wRC+`: 球場補正済み加重得点創出

- **パーセンタイルランキング：**
  - 各成績指標に対応する`_percentile`フィールド（例：`AVG_percentile`）
  - 0.0～1.0の範囲（0.0 = 最下位、1.0 = 最上位）

**パーセンタイル算出方法：**
- 母集団：`Qual = 1`（規定打席到達）の選手のみ
- `Qual = 0`の選手も、規定打席到達選手を母集団とした場合の相対的なランキングを算出
- 計算式：`percentile = (母集団でこの値より小さい値の数) / (母集団の総数)`

**データソース：**
FanGraphsのNPB打撃成績データ（2019年以降のデータが利用可能）

**総レコード数：** 482選手
**規定打席到達選手数（母集団）：** 87選手

## 使い方

1. `barchart_sample.html`をウェブブラウザで開く
2. 「チームを選択」プルダウンからNPBチームを選択
3. 「選手を選択」プルダウンから選手を選択（PA降順で表示）
4. 選手のパーセンタイルランキングチャートが表示される

**注意事項：**
- JSONファイルは同じディレクトリに配置する必要があります
- インターネット接続が必要です（D3.js、Google Fontsを外部から読み込むため）

## 開発環境

- すべてのファイルはスタンドアロンで動作
- ローカルサーバーの起動は不要（ブラウザで直接開けます）
- モダンブラウザ推奨（Chrome, Firefox, Safari, Edge最新版）

## カスタマイズ

### 閾値の変更
PA閾値（現在301）を変更する場合：
```javascript
const hasLowPA = playerData.PA < 301; // この数値を変更
```

### カラースケールの変更
グラデーションカラーを変更する場合：
```javascript
const colorScale = d3.scaleLinear()
    .domain([0, 25, 45, 50, 55, 75, 100])
    .range(['#335aa1', '#7b96c1', '#b4ced2', '#b4ced2','#b4ced2','#c67d70', '#c31e24'])
```

### 表示指標の変更
`percentileMetrics`配列を編集して、表示する指標を変更できます。
